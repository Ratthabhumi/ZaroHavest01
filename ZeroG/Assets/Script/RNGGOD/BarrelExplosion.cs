using UnityEngine;
using System.Collections;

public class BarrelExplosion : MonoBehaviour
{
    [Header("‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤‡∏Å‡∏≤‡∏£‡∏£‡∏∞‡πÄ‡∏ö‡∏¥‡∏î")]
    [Tooltip("‡∏•‡∏≤‡∏Å Prefab ‡πÄ‡∏≠‡∏ü‡πÄ‡∏ü‡∏Å‡∏ï‡πå‡∏£‡∏∞‡πÄ‡∏ö‡∏¥‡∏î‡∏°‡∏≤‡πÉ‡∏™‡πà‡∏ï‡∏£‡∏á‡∏ô‡∏µ‡πâ (‡∏ñ‡πâ‡∏≤‡∏°‡∏µ)")]
    public GameObject explosionEffectPrefab;
    [Tooltip("‡∏´‡∏ô‡πà‡∏ß‡∏á‡πÄ‡∏ß‡∏•‡∏≤‡∏Å‡πà‡∏≠‡∏ô‡∏ó‡∏µ‡πà‡∏ñ‡∏±‡∏á‡∏à‡∏∞‡∏´‡∏≤‡∏¢‡πÑ‡∏õ (‡∏ß‡∏¥‡∏ô‡∏≤‡∏ó‡∏µ)")]
    public float explosionDelay = 0.5f;

    void Start()
    {
        // ‡∏û‡∏≠‡∏ñ‡∏±‡∏á‡πÄ‡∏Å‡∏¥‡∏î‡∏°‡∏≤ ‡πÉ‡∏´‡πâ‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏Å‡∏£‡∏∞‡∏ö‡∏ß‡∏ô‡∏Å‡∏≤‡∏£‡∏£‡∏∞‡πÄ‡∏ö‡∏¥‡∏î‡∏ó‡∏±‡∏ô‡∏ó‡∏µ
        StartCoroutine(ExplodeRoutine());
    }

    IEnumerator ExplodeRoutine()
    {
        Debug.Log("üí• ‡∏ñ‡∏±‡∏á‡∏£‡∏∞‡πÄ‡∏ö‡∏¥‡∏î‡∏ó‡∏≥‡∏á‡∏≤‡∏ô! ‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏•‡πâ‡∏≤‡∏á‡∏ö‡∏≤‡∏á...");

        // 1. ‡πÅ‡∏™‡∏î‡∏á‡πÄ‡∏≠‡∏ü‡πÄ‡∏ü‡∏Å‡∏ï‡πå‡∏£‡∏∞‡πÄ‡∏ö‡∏¥‡∏î (‡∏ñ‡πâ‡∏≤‡∏°‡∏µ)
        if (explosionEffectPrefab != null)
        {
            Instantiate(explosionEffectPrefab, transform.position, Quaternion.identity);
        }

        // 2. ‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤‡∏ï‡∏±‡∏ß‡∏•‡∏∞‡∏Ñ‡∏£‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î‡πÉ‡∏ô‡∏â‡∏≤‡∏Å
        // (‡∏ß‡∏¥‡∏ò‡∏µ‡∏ô‡∏µ‡πâ‡∏≠‡∏≤‡∏à‡∏à‡∏∞‡πÑ‡∏°‡πà‡πÄ‡∏£‡πá‡∏ß‡∏ó‡∏µ‡πà‡∏™‡∏∏‡∏î ‡πÅ‡∏ï‡πà‡∏ä‡∏±‡∏ß‡∏£‡πå‡πÅ‡∏•‡∏∞‡∏á‡πà‡∏≤‡∏¢‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏ï‡∏≠‡∏ô‡∏ô‡∏µ‡πâ‡∏Ñ‡∏£‡∏±‡∏ö)
       GameObject[] allObjects = UnityEngine.Object.FindObjectsByType<GameObject>(FindObjectsSortMode.None);

        foreach (GameObject obj in allObjects)
        {
            // ‡πÄ‡∏ä‡πá‡∏Ñ‡∏ß‡πà‡∏≤‡πÄ‡∏õ‡πá‡∏ô‡∏ï‡∏±‡∏ß‡∏•‡∏∞‡∏Ñ‡∏£‡∏ó‡∏µ‡πà‡πÄ‡∏£‡∏≤‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏°‡∏≤‡∏´‡∏£‡∏∑‡∏≠‡πÄ‡∏õ‡∏•‡πà‡∏≤ (‡∏ä‡∏∑‡πà‡∏≠‡∏Ç‡∏∂‡πâ‡∏ô‡∏ï‡πâ‡∏ô‡∏î‡πâ‡∏ß‡∏¢ Char_ ‡πÅ‡∏•‡∏∞‡∏•‡∏á‡∏ó‡πâ‡∏≤‡∏¢‡∏î‡πâ‡∏ß‡∏¢ (Clone))
            if (obj.name.StartsWith("Char_") && obj.name.EndsWith("(Clone)"))
            {
                // üõ°Ô∏è ‡∏Ç‡πâ‡∏≠‡∏¢‡∏Å‡πÄ‡∏ß‡πâ‡∏ô: ‡∏ñ‡πâ‡∏≤‡πÄ‡∏õ‡πá‡∏ô‡∏ö‡∏≠‡∏™ (Char_06) ‡πÉ‡∏´‡πâ‡∏Ç‡πâ‡∏≤‡∏°‡πÑ‡∏õ!
                if (obj.name.Contains("Char_06_Boss"))
                {
                    Debug.Log($"üõ°Ô∏è ‡πÄ‡∏à‡∏≠‡∏ö‡∏≠‡∏™ {obj.name} - ‡∏¢‡∏Å‡πÄ‡∏ß‡πâ‡∏ô‡πÑ‡∏ß‡πâ ‡πÑ‡∏°‡πà‡∏ó‡∏≥‡∏•‡∏≤‡∏¢");
                    continue; // ‡∏Ç‡πâ‡∏≤‡∏°‡∏•‡∏π‡∏õ‡∏ô‡∏µ‡πâ‡πÑ‡∏õ
                }

                // ‡∏ñ‡πâ‡∏≤‡πÑ‡∏°‡πà‡πÉ‡∏ä‡πà‡∏ö‡∏≠‡∏™ ‡πÅ‡∏•‡∏∞‡πÑ‡∏°‡πà‡πÉ‡∏ä‡πà‡∏ï‡∏±‡∏ß‡∏ñ‡∏±‡∏á‡∏ô‡∏µ‡πâ‡πÄ‡∏≠‡∏á (‡πÄ‡∏î‡∏µ‡πã‡∏¢‡∏ß‡πÄ‡∏£‡∏≤‡∏ó‡∏≥‡∏•‡∏≤‡∏¢‡∏ñ‡∏±‡∏á‡∏ï‡∏≠‡∏ô‡∏à‡∏ö)
                if (obj != this.gameObject)
                {
                    Debug.Log($"üî• ‡∏ó‡∏≥‡∏•‡∏≤‡∏¢: {obj.name}");
                    Destroy(obj);
                    // ‡πÄ‡∏û‡∏¥‡πà‡∏°‡πÄ‡∏≠‡∏ü‡πÄ‡∏ü‡∏Å‡∏ï‡πå‡∏£‡∏∞‡πÄ‡∏ö‡∏¥‡∏î‡πÄ‡∏•‡πá‡∏Å‡πÜ ‡∏ï‡∏£‡∏á‡∏à‡∏∏‡∏î‡∏ó‡∏µ‡πà‡∏ï‡∏±‡∏ß‡∏•‡∏∞‡∏Ñ‡∏£‡∏ï‡∏≤‡∏¢‡∏î‡πâ‡∏ß‡∏¢‡∏Å‡πá‡πÑ‡∏î‡πâ‡∏ô‡∏∞ (‡∏ñ‡πâ‡∏≤‡∏≠‡∏¢‡∏≤‡∏Å‡∏ó‡∏≥)
                    // if (explosionEffectPrefab != null) Instantiate(explosionEffectPrefab, obj.transform.position, Quaternion.identity);
                }
            }
        }

        // 3. ‡∏£‡∏≠‡πÅ‡∏õ‡πä‡∏ö‡∏ô‡∏∂‡∏á‡πÉ‡∏´‡πâ‡πÄ‡∏≠‡∏ü‡πÄ‡∏ü‡∏Å‡∏ï‡πå‡πÄ‡∏•‡πà‡∏ô ‡πÅ‡∏•‡πâ‡∏ß‡∏ó‡∏≥‡∏•‡∏≤‡∏¢‡∏ï‡∏±‡∏ß‡πÄ‡∏≠‡∏á
        yield return new WaitForSeconds(explosionDelay);
        Debug.Log("üõ¢Ô∏è ‡∏ñ‡∏±‡∏á‡∏ó‡∏≥‡∏•‡∏≤‡∏¢‡∏ï‡∏±‡∏ß‡πÄ‡∏≠‡∏á");
        Destroy(gameObject);
    }
}